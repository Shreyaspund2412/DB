-- STEP 1: Create Tables
CREATE TABLE Person (
    driver_id INT PRIMARY KEY,
    name VARCHAR(50),
    address VARCHAR(100)
);

CREATE TABLE Car (
    license VARCHAR(20) PRIMARY KEY,
    model VARCHAR(50),
    year INT
);

CREATE TABLE Accident (
    report_no INT PRIMARY KEY,
    date_acc DATE,
    location VARCHAR(100)
);

CREATE TABLE Owns (
    driver_id INT,
    license VARCHAR(20),
    FOREIGN KEY (driver_id) REFERENCES Person(driver_id),
    FOREIGN KEY (license) REFERENCES Car(license)
);

CREATE TABLE Participated (
    driver_id INT,
    model VARCHAR(50),
    report_no INT,
    damage_amount DECIMAL(10,2),
    FOREIGN KEY (driver_id) REFERENCES Person(driver_id),
    FOREIGN KEY (report_no) REFERENCES Accident(report_no)
);

-- STEP 2: Insert Records
INSERT INTO Person VALUES (201, 'Rahul', 'Pune');
INSERT INTO Person VALUES (202, 'Karan', 'Mumbai');
INSERT INTO Person VALUES (203, 'Sujal', 'Nashik');

INSERT INTO Car VALUES ('MH12AB1234', 'Honda City', 2020);
INSERT INTO Car VALUES ('MH14XY9876', 'Swift', 2018);
INSERT INTO Car VALUES ('MH16PQ5555', 'Creta', 2021);

INSERT INTO Accident VALUES (6001, '2025-01-10', 'Baner');
INSERT INTO Accident VALUES (6006, '2025-02-05', 'Kothrud');
INSERT INTO Accident VALUES (6011, '2024-12-12', 'Nigdi');

INSERT INTO Owns VALUES (201, 'MH12AB1234');
INSERT INTO Owns VALUES (202, 'MH14XY9876');
INSERT INTO Owns VALUES (203, 'MH16PQ5555');

INSERT INTO Participated VALUES (201, 'Honda City', 6001, 25000);
INSERT INTO Participated VALUES (202, 'Swift', 6006, 18000);
INSERT INTO Participated VALUES (203, 'Creta', 6011, 30000);

-- STEP 3: Create View Driver_Car_View
CREATE VIEW Driver_Car_View AS
SELECT p.name, c.model
FROM Person p
JOIN Owns o ON p.driver_id = o.driver_id
JOIN Car c ON o.license = c.license;

-- STEP 4: Display All Records from View
SELECT * FROM Driver_Car_View;

-- STEP 5: Modify View to Include Car’s Year
CREATE OR REPLACE VIEW Driver_Car_View AS
SELECT p.name, c.model, c.year
FROM Person p
JOIN Owns o ON p.driver_id = o.driver_id
JOIN Car c ON o.license = c.license;

-- STEP 6: Create Sequence for Accident Report Numbers
CREATE SEQUENCE seq_report_no
START WITH 6001
INCREMENT BY 5;

-- STEP 7: Create Composite Index (model + year)
CREATE INDEX idx_model_year ON Car(model, year);

-- STEP 8: View for Drivers with Damage > ₹20,000
CREATE VIEW High_Damage_Drivers AS
SELECT p.name, pa.damage_amount
FROM Person p
JOIN Participated pa ON p.driver_id = pa.driver_id
WHERE pa.damage_amount > 20000;

-- STEP 9: Sequence for driver_id
CREATE SEQUENCE seq_driver_id
START WITH 204
INCREMENT BY 1;

-- STEP 10: Insert New Person using Sequence
INSERT INTO Person VALUES (seq_driver_id.NEXTVAL, 'Pratik', 'Satara');

-- STEP 11: Create Index on name
CREATE INDEX idx_person_name ON Person(name);

-- STEP 12: Drop Index
DROP INDEX idx_person_name;

-- STEP 13: View for Accidents in 2025
CREATE VIEW Recent_Accidents AS
SELECT * FROM Accident
WHERE EXTRACT(YEAR FROM date_acc) = 2025;

-- STEP 14: Drop View
DROP VIEW Recent_Accidents;

-- STEP 15: Create Synonym for Accident Table
CREATE SYNONYM acc_info FOR Accident;

-- STEP 16: Insert New Accident using Synonym
INSERT INTO acc_info VALUES (seq_report_no.NEXTVAL, '2025-03-05', 'Warje');

-- STEP 17: Unique Index on Car License
CREATE UNIQUE INDEX idx_license_unique ON Car(license);

-- STEP 18: View for Cars Manufactured After 2019
CREATE VIEW Recent_Car_Drivers AS
SELECT p.name, c.model, c.year
FROM Person p
JOIN Owns o ON p.driver_id = o.driver_id
JOIN Car c ON o.license = c.license
WHERE c.year > 2019;

-- STEP 19: Sequence for Accident Report Numbers + Insert
CREATE SEQUENCE seq_accident_report START WITH 7001 INCREMENT BY 5;
INSERT INTO Accident VALUES (seq_accident_report.NEXTVAL, '2025-04-15', 'Deccan');

-- STEP 20: Synonym for Owns Table
CREATE SYNONYM owns_info FOR Owns;

-- Use synonym
SELECT * FROM owns_info;

-- STEP 21: Index for damage_amount
CREATE INDEX idx_damage_amount ON Participated(damage_amount);
